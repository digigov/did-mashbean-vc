extends layout

block content
  h1(style="text-align: center") 數位豆泥卡申請
  - var candleLevel = (Math.floor(checkinCount / 50) % 7) + 1
  - var round = Math.floor((checkinCount) / 350) + 1
  - var roundText = round > 1 ? `${round}週目 ` : ''
  img.img-fluid.mx-auto.d-block.rounded.mb-4(src="/images/avatar_candle_lvl_" + candleLevel + ".png" alt="Avatar" style="max-width: 200px")
  if round > 1
    p.text-center.text-secondary.mb-4= roundText

  ul.nav.nav-tabs.mb-4
    li.nav-item
      a.nav-link.active(href="/") 申請豆泥卡(發行)
    li.nav-item  
      a.nav-link(href="/checkin") 幫豆泥點蠟，直到豆泥燒完(驗證)


  div(style="background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px")
    
    div(style="margin-bottom: 32px; background: #f9fafb; padding: 24px; border-radius: 8px; border-left: 4px solid #3b82f6")
      h3(style="font-size: 20px; font-weight: 600; margin-bottom: 16px") 關於數位部數位皮夾計畫
      p(style="color: #374151; line-height: 1.6")
        | 數位皮夾採用去中心化技術架構，以安全和隱私保護為核心，確保您的數位證件獲得可靠保護。
      div(style="margin-top: 16px; background: white; padding: 16px; border-radius: 8px")
        h4(style="font-weight: 500; margin-bottom: 8px") 計畫時程
        ul(style="list-style-type: disc; padding-left: 20px; color: #374151")
          li(style="margin-bottom: 8px") 2024年：完成規劃文件及APP功能架構
          li(style="margin-bottom: 8px") 2025年：進行第一階段開發及沙盒測試
          li(style="margin-bottom: 8px") 2026年：開始產品上線前測試
        p(style="margin-top: 16px; font-size: 14px; color: #4b5563")
          | 詳細資訊請參考 
          a(href="https://www.wallet.gov.tw/news.html" target="_blank" style="color: #2563eb; text-decoration: none") 數位部網站(另開新視窗)

    div(style="margin-bottom: 32px")
      div(style="border-bottom: 1px solid #e5e7eb; padding-bottom: 32px")
        h3(style="font-size: 20px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center")
          div(style="display: inline-flex; align-items: center; justify-content: center; width: 32px; height: 32px; margin-right: 12px; background: #fb923c; color: white; font-size: 18px; font-weight: 600; border-radius: 50%") 壹
          | 下載數位皮夾測試版 App

        div(style="background: #fefce8; border-radius: 8px; padding: 16px; margin-bottom: 24px")
          p(style="color: #4b5563")
            i(style="margin-right: 8px").fas.fa-info-circle
            strong 注意事項：
            br
            | • iOS 用戶需先安裝 TestFlight 才能下載測試版本
            br
            | • Android 用戶需先加入測試成員名單才能下載

        div(style="display: grid; grid-template-columns: 1fr; gap: 32px")
          div(style="display: flex; flex-direction: column; align-items: center; background: #f9fafb; padding: 24px; border-radius: 8px")
            h4(style="font-weight: 500; margin-bottom: 16px") Android 版本
            img(style="width: 160px; height: 160px; margin-bottom: 16px" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://play.google.com/apps/testing/tw.gov.moda.diw" loading="lazy")
            a(href="https://play.google.com/apps/testing/tw.gov.moda.diw")
              img(style="width: 160px; margin-bottom: 8px" src="/images/googleplay.png" loading="lazy")
            span(style="color: #4b5563; font-size: 14px") 支援 Android 10 以上

          div(style="display: flex; flex-direction: column; align-items: center; background: #f9fafb; padding: 24px; border-radius: 8px")
            h4(style="font-weight: 500; margin-bottom: 16px") iOS 版本
            img(style="width: 160px; height: 160px; margin-bottom: 16px" src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://testflight.apple.com/join/gxr3mQFj" loading="lazy")
            a(href="https://testflight.apple.com/join/gxr3mQFj")
              img(style="width: 160px; margin-bottom: 8px" src="/images/applestore.png" loading="lazy")
            span(style="color: #4b5563; font-size: 14px") 支援 iOS 15.0 以上

      div(style="background: #f9fafb; border-radius: 8px; padding: 32px")
        h3(style="font-size: 20px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center")
          div(style="display: inline-flex; align-items: center; justify-content: center; width: 32px; height: 32px; margin-right: 12px; background: #fb923c; color: white; font-size: 18px; font-weight: 600; border-radius: 50%") 貳
          | 取得數位豆泥卡

        p(style="text-align: center; margin-bottom: 16px") 請用數位皮夾 app 掃描或點擊連結以取得您的數位豆泥卡

        div(style="background: #f9fafb; border-radius: 8px; padding: 32px")
          div(style="text-align: center")
            div(style="display: grid; grid-template-columns: 1fr; gap: 32px; md:grid-template-columns: repeat(2, 1fr)")
              div(style="color: #374151")
                p(style="margin-bottom: 8px")
                  strong 操作步驟：
                ol(style="display: inline-block; text-align: left")
                  li 1. 開啟已安裝的數位皮夾 App
                  li 2. 建立您的數位皮包
                  li 3. 掃描右方 QR Code

              div(style="background: white; padding: 24px; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center")
                p(style="font-size: 14px; color: #6b7280; margin-bottom: 16px") QR Code 有效期限至：
                  br
                  | #{new Date(qrCodeData.expired).toLocaleString('zh-TW', {timeZone: 'Asia/Taipei'})}
                
                img(alt="QR Code" style="width: 200px; height: 200px" src=qrCodeData.qrCode loading="lazy")

                p(style="font-size: 14px; color: #6b7280; margin-top: 16px")
                  i(style="margin-right: 4px").fas.fa-info-circle
                  | 如果您使用手機瀏覽且已安裝數位皮夾，

                a(href=qrCodeData.deepLink style="display: inline-block; margin-top: 16px; background: #fb923c; color: white; padding: 8px 24px; border-radius: 8px; font-size: 14px; text-decoration: none")
                  i(style="margin-right: 8px").fas.fa-external-link-alt
                  | 直接點擊新增